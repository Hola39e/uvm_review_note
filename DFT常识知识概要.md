# DFT常识知识概要

## DFT是什么

可测性设计，指的是在芯片原始设计中阶段即插入各种用于提高芯片可测试性（包括可控制性和可观测性）的硬件逻辑，通过这部分逻辑，生成测试向量，达到测试大规模芯片的目的（在后端中添加的）。

## DFT核心技术与不同方面

### DFT的种类

DFT主要有三种

- 扫描路径 SCAN path，有的又叫SCAN logic， SCAN desgin，表示都是一个意思，注意跟Boundary SCAN是两种测试
- 存储器内建自测试MBIST，其实除了MBIST还有别的BIST，M指的是Memory，针对存储器的，其核心思想是测试向量是内建的
- 边界扫描Boundary SCAN主要是用来检查芯片IO的

### 扫描路径设计 SCAN design

参考内容

> https://blog.csdn.net/m0_52840978/article/details/123242313?spm=1001.2014.3001.5502

这种方式是更换DFF，将普通的触发器更换为MUX-DFF，SCAN包含两个步骤，SCAN replacement and SCAN stitching。

MUX DFF的样子

![img](https://img-blog.csdnimg.cn/55540e82158b479b8a741ccd829227cb.png)

如果是针对电平敏感的锁存器扫描，还有一种带扫描端的锁存器

![img](https://img-blog.csdnimg.cn/3d40942e647d484084bc97ad2b4ca68e.png)

- 正常模式下，c为高，锁存数据d，mq输出
- 扫描模式下，a为高，锁存数据scan in，mq输出，然后触发器采样，scan out 输出

#### SCAN path的测试流程

- 工作在移位模式，输入测试向量
- 工作在捕获模式，scan enable = 0，工作在正常状态
- 工作在移位模式，将故障响应通过扫描链输出到输出端

#### SCAN path的测试规则

1. 使用同种类扫描单元进行替换，通常选择带多路选择器的扫描触发器；
2. 在原始输入端必须能够对所有触发器的时钟端和异步复位端进行控制；
3. 时钟信号不能作为触发器的输入信号；
4. 三态总线在扫描测试模式必须处于非活跃状态；
5. ATPG无法识别的逻辑应加以屏蔽和旁路。

### 内建自测试MBIST

参考资料

> https://blog.csdn.net/m0_52840978/article/details/123266149?spm=1001.2014.3001.5502

#### MBIST优缺点

优点

- 有自动工具支持
- 可以进行全速测试
- 有良好的故障覆盖率
- 对于测试机来说，消耗最少

缺点

- 有一定的硬件开销
- 对存储器带来永久的性能损失
- 故障诊断和修复比较麻烦
- 硬件本身的可测试性

#### 基本概念

存储器内建自测试，内建的含义是针对存储器的测试向量而不是由外部测试机台生成，是由内建的存储器测试逻辑自动生成，并进行结果对比。在MBIST测试中，只需要从机台通过JTAG接口下达测试的执行，就可以从TDO接口获取测试结果。

**MBIST附加的额外电路：向量生成器，BIST控制器，响应分析器**

MBIST逻辑能正常工作，需要保证memory时钟源准确有效。

针对MBIST memory时钟的描述实际上也适用于需要做全速测试的逻辑部分（Scan：At-Speed）。对前端设计者来说，设计具备DFT设计的前提条件：

- 被测试逻辑的时钟信号在 dft mode下有效，频率正确
- 与时钟信号有关的逻辑在dft mode下能够准确工作（复位有效，旁路/选择正确等）
- SDC中对时钟源，时钟结构（generated clock）描述准确无误。

MBIST可以修复存储器，提高良率（存储器内建自修复）

### 边界扫描 Boundary SCAN

边界扫描原理是在核心逻辑电路的输入输出端口都增加一个寄存器，通过将这些IO上的寄存器连接起来，可以将数据串行输入被测单元，再从相应端口串行读出。

- 芯片级测试：即可以对芯片本身进行测试和调试，使芯片工作在正常功能模式，通过输入端输入测试矢量，并通过观察串行移位的输出响应进行调试。
- 板级测试：检测集成电路和PCB之间的互连。实现原理是将一块PCB上所有具有边界扫描的IC中的扫描寄存器连接在一起，通过一定的测试矢量，可以发现元件是否丢失或者摆放错误，同时可以检测引脚的开路和短路故障。（因此BSD不单只有一条scan chain，可能有多条scan chain）
- 系统级测试，在板级集成后，可以通过对板上CPLD或者Flash的在线编程，实现系统级测试。

一般最主要的测试时板级测试

#### BSD的主要组成：

- TAP控制器
- 寄存器组
  - 边界扫描寄存器
  - 旁路寄存器（用与表示在板级测试中无须测试的IC，直接旁路bypass掉）
  - 标志寄存器，32位，有关于该器件版本号、器件型号等信息

#### BSD端口定义

- TCK：test clock，BSD的测试时钟是独立的，与PCB和IC上的时钟无关，但也可以复用原来的时钟
- TMS：test mode select，用来选择不同的工作模式（数据捕获、移位、暂停），只需要有一个信号来控制，通过输入特定的序列来进入不同的工作模式，使用状态机实现的。
- TDI：test data in，以串行方式输入的数据TDI有两种。一种是指令信号，送入指令寄存器；另一种是测试数据（激励、输出响应和其他信号），它输入到相应的边界扫描寄存器中去。
- TDO：test data out， 以串行输出的数据也有两种，一种是从指令寄存器移位出来的指令，另一种是从边界扫描寄存器移位出来的数据。
- 可选的TRST，为测试系统复位信号，作用是强制复位

边界扫描寄存器

![img](https://img-blog.csdnimg.cn/197b085e105d4bcc8285d9ea0350d22e.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5a2Q5aKo56Wt,size_20,color_FFFFFF,t_70,g_se,x_16)

指令寄存器

![img](https://img-blog.csdnimg.cn/e530b770b1fb4da589a6269e23a284c1.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5a2Q5aKo56Wt,size_12,color_FFFFFF,t_70,g_se,x_16)

指令寄存器由移位寄存器和锁存器组成，长度等于指令的长度。IR可以连接在TDI和TDO的两端，经TDI串行输入指令，并且送入锁存器，保存当前指令。在这两部分中有个译码单元，负责识别当前指令。由于JTAG有3个强制指令，所以该寄存器的宽度至少为2 位。

